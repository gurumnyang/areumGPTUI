<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>학생용 ChatGPT 서비스 - 채팅</title>
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
    rel="stylesheet"
  >
  <!-- 구글 애드센스 예시 스크립트 (광고 배치) -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
</head>
<body class="bg-light">
  <div class="container py-3">
    <h1>ChatGPT 튜터</h1>
    <div class="mb-3">
      <label for="userMessage" class="form-label">질문 / 요청</label>
      <textarea id="userMessage" class="form-control" rows="3"></textarea>
    </div>
    <button id="sendBtn" class="btn btn-primary mb-3">전송</button>
    <button id="logoutBtn" class="btn btn-outline-secondary mb-3">로그아웃</button>

    <div id="chatWindow" class="border p-3 bg-white" style="min-height: 300px;">
      <!-- 대화 내용 표시 -->
    </div>

    <!-- 광고 예시 영역 -->
    <div class="my-4">
      <ins class="adsbygoogle"
           style="display:block"
           data-ad-client="ca-pub-xxxxxxxxxxxxxxxx"
           data-ad-slot="1234567890"
           data-ad-format="auto"
           data-full-width-responsive="true"></ins>
      <script>
        (adsbygoogle = window.adsbygoogle || []).push({});
      </script>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.4/dist/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    $(function() {
      // 로그아웃
      $('#logoutBtn').click(function() {
        window.location.href = '/api/logout';
      });

      // 메시지 전송
      $('#sendBtn').click(function() {
        const message = $('#userMessage').val().trim();
        if(!message) return;

        // 사용자 메시지 표시
        const userHtml = `<div class="mb-2"><strong>나:</strong> ${message}</div>`;
        $('#chatWindow').append(userHtml);

        // 서버에 전송
        fetch('/api/chat', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ message })
        })
        .then(res => res.json())
        .then(data => {
          if(data.error) {
            alert(data.error);
          } else {
            const assistantMessage = data.assistant || '';
            const assistantHtml = `<div class="mb-2"><strong>GPT:</strong> ${assistantMessage}</div>`;
            $('#chatWindow').append(assistantHtml);
          }
        })
        .catch(err => {
          console.error(err);
          alert('오류 발생');
        });
      });
    });
  </script>
</body>
</html>
